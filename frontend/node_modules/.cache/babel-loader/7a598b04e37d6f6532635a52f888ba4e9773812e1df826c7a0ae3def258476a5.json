{"ast":null,"code":"var Validator = require('./validator.js');\nvar Constraint = require('./constraints.js').Constraint;\nvar VarArgsConstraint = require('./constraints.js').VarArgsConstraint;\nvar common = require('./common.js');\nvar serialize = require('./serialize.js');\n\n//\n// Array Validator\n//\n\nvar ArrayValidator = module.exports = function (context, items) {\n  Validator.call(this, context, 'array');\n  this.addOption('additionalItems', true);\n  this.addConstraint(new Constraint('maxItems', function (value, m, options, path) {\n    return value.length <= m ? [] : [this.makeError('Number of items is larger than maximum: ' + m, 'maxItems', path)];\n  }));\n  this.addConstraint(new Constraint('minItems', function (value, m, options, path) {\n    return value.length >= m ? [] : [this.makeError('Number of items is less than minimum: ' + m, 'minItems', path)];\n  }));\n  this.addConstraint(new Constraint('uniqueItems', function (value, u, options, path) {\n    if (!u) return [];\n    var errors = [];\n    var cache = {};\n    for (var i = 0; i < value.length; ++i) {\n      var str = JSON.stringify(value[i]);\n      if (cache[str]) {\n        this.addError(errors, 'Array items are not unique', 'uniqueItems', path);\n        break;\n      }\n      cache[str] = true;\n    }\n    ;\n    return errors;\n  }));\n  this.addConstraint(new VarArgsConstraint('items', function (values, items, options, path) {\n    var errors = [];\n    var self = this;\n    if (items.length > 1) {\n      // array tuple\n\n      values.forEach(function (value, i) {\n        if (i < items.length) {\n          self.addErrors(errors, items[i].validate(value, options, path + '/' + i));\n        } else if (!self.additionalItems()) {\n          self.addError(errors, 'Array index outside tuple length: ' + i, 'additionalItems', path + '/' + i);\n        }\n      });\n    } else if (items.length === 1 && !this.additionalItems()) {\n      // array\n\n      values.forEach(function (value, i) {\n        self.addErrors(errors, items[0].validate(value, options, path + '/' + i));\n      });\n    }\n    return errors;\n  }, function (items) {\n    if (items.length > 1) {\n      // tuple\n      return items.map(function (item) {\n        return item.toJSON();\n      });\n    } else if (items.length === 1) {\n      return items[0].toJSON();\n    } else return 'null';\n  }, function (schema) {\n    if (common.isArray(schema)) {\n      // tuple\n      return schema.map(function (item) {\n        return serialize.fromJSON(item);\n      });\n    } else {\n      return [serialize.fromJSON(schema)];\n    }\n  }));\n  this.addCheck(function (values, options, path) {\n    return common.isArray(values) ? [] : [this.makeError('Value is not a array', 'array', path)];\n  });\n\n  // set items constraint\n  if (items && common.isArray(items) && items.length) {\n    this.items.apply(this, items);\n  }\n};\ncommon.extend(ArrayValidator.prototype, Validator.prototype);","map":{"version":3,"names":["Validator","require","Constraint","VarArgsConstraint","common","serialize","ArrayValidator","module","exports","context","items","call","addOption","addConstraint","value","m","options","path","length","makeError","u","errors","cache","i","str","JSON","stringify","addError","values","self","forEach","addErrors","validate","additionalItems","map","item","toJSON","schema","isArray","fromJSON","addCheck","apply","extend","prototype"],"sources":["C:/game/mern/node_modules/jski/lib/array.js"],"sourcesContent":["var Validator = require('./validator.js');\nvar Constraint = require('./constraints.js').Constraint;\nvar VarArgsConstraint = require('./constraints.js').VarArgsConstraint;\nvar common = require('./common.js');\nvar serialize = require('./serialize.js');\n\n//\n// Array Validator\n//\n\nvar ArrayValidator = module.exports = function(context, items) {\n\n  Validator.call(this, context, 'array');\n\n  this.addOption('additionalItems', true);\n\n  this.addConstraint(new Constraint(\n    'maxItems',\n    function(value, m, options, path) {\n      return value.length <= m ? [] : [\n        this.makeError('Number of items is larger than maximum: ' + m, 'maxItems', path)\n      ];\n    }\n  ));\n\n  this.addConstraint(new Constraint(\n    'minItems',\n    function(value, m, options, path) {\n      return value.length >= m ? [] : [\n        this.makeError('Number of items is less than minimum: ' + m, 'minItems', path)\n      ];\n    }\n  ));\n\n  this.addConstraint(new Constraint(\n    'uniqueItems',\n    function(value, u, options, path) {\n      if (!u) return [];\n\n      var errors = [];\n      var cache = {};\n\n      for (var i = 0; i < value.length; ++i) {\n        var str = JSON.stringify(value[i]);\n        if (cache[str]) {\n          this.addError(errors, 'Array items are not unique', 'uniqueItems', path);\n          break;\n        }\n        cache[str] = true;\n      };\n      return errors;\n    }\n  ));\n\n  this.addConstraint(new VarArgsConstraint(\n    'items',\n    function(values, items, options, path) {\n\n      var errors = [];\n      var self = this;\n\n      if (items.length > 1) {\n        // array tuple\n\n        values.forEach(function(value, i) {\n          if (i < items.length) {\n            self.addErrors(errors, items[i].validate(value, options, path + '/' + i));\n          }\n          else if (!self.additionalItems()) {\n            self.addError(errors, 'Array index outside tuple length: ' + i, 'additionalItems', path + '/' + i);\n          }\n        });\n      }\n      else if (items.length === 1 && !this.additionalItems()) {\n        // array\n\n        values.forEach(function(value, i) {\n          self.addErrors(errors, items[0].validate(value, options, path + '/' + i));\n        });\n      }\n\n      return errors;\n    },\n\n    function(items) {\n      if (items.length > 1) {\n        // tuple\n        return items.map(function(item) {\n          return item.toJSON();\n        });\n      }\n      else if (items.length === 1) {\n        return items[0].toJSON();\n      }\n      else return 'null';\n    },\n\n    function(schema) {\n      if (common.isArray(schema)) {\n        // tuple\n        return schema.map(function(item) {\n          return serialize.fromJSON(item);\n        });\n      }\n      else {\n        return [serialize.fromJSON(schema)];\n      }\n    }\n  ));\n\n  this.addCheck(function(values, options, path) {\n    return common.isArray(values) ? [] : [\n      this.makeError('Value is not a array', 'array', path)\n    ];\n  });\n\n  // set items constraint\n  if (items && common.isArray(items) && items.length) {\n    this.items.apply(this, items);\n  }\n};\n\ncommon.extend(ArrayValidator.prototype, Validator.prototype);\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}