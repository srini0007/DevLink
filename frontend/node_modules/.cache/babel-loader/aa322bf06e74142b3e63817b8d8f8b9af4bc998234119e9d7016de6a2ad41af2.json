{"ast":null,"code":"var Validator = require('./validator.js');\nvar Constraint = require('./constraints.js').Constraint;\nvar VarArgsConstraint = require('./constraints.js').VarArgsConstraint;\nvar common = require('./common.js');\nvar serialize = require('./serialize.js');\n\n//\n// Object Validator\n//\n\nvar ObjectValidator = module.exports = function (context, args) {\n  Validator.call(this, context, 'object');\n  var properties = args ? args[0] : null;\n  this.addOption('additionalProperties', true);\n  this.addConstraint(new Constraint('maxProperties', function (value, m, options, path) {\n    return Object.keys(value).length <= m ? [] : [this.makeError('Number of properties is larger than maximum: ' + m, 'maxProperties', path)];\n  }));\n  this.addConstraint(new Constraint('minProperties', function (value, m, options, path) {\n    return Object.keys(value).length >= m ? [] : [this.makeError('Number of properties is less than minimum: ' + m, 'minProperties', path)];\n  }));\n  this.addConstraint(new VarArgsConstraint('required', function (value, reqs, options, path) {\n    var errors = [];\n    var self = this;\n    reqs.forEach(function (name) {\n      if (!value.hasOwnProperty(name)) {\n        self.addError(errors, 'Required property is missing: ' + name, 'required', path + '/' + name);\n      }\n    });\n    return errors;\n  }));\n  this.addConstraint(new Constraint('properties', function (value, properties, options, path) {\n    var errors = [];\n    for (var n in value) {\n      if (properties[n]) {\n        this.addErrors(errors, properties[n].validate(value[n], options, path + '/' + n));\n      } else if (!this.additionalProperties()) {\n        this.addError(errors, 'Object has no property with name: ' + n, 'additionalProperties', path + '/' + n);\n      }\n    }\n    return errors;\n  }, function (properties) {\n    var schema = {};\n    Object.keys(properties).forEach(function (key) {\n      schema[key] = properties[key].toJSON();\n    });\n    return schema;\n  }, function (schema) {\n    properties = {};\n    Object.keys(schema).forEach(function (key) {\n      properties[key] = serialize.fromJSON(schema[key]);\n    });\n    return properties;\n  }));\n  this.addCheck(function (value, options, path) {\n    return common.isObject(value) && !common.isArray(value) ? [] : [this.makeError('Value is not an object', 'object', path)];\n  });\n\n  // shortcut to set constraint\n  if (properties) this.properties(properties);\n};\ncommon.extend(ObjectValidator.prototype, Validator.prototype);","map":{"version":3,"names":["Validator","require","Constraint","VarArgsConstraint","common","serialize","ObjectValidator","module","exports","context","args","call","properties","addOption","addConstraint","value","m","options","path","Object","keys","length","makeError","reqs","errors","self","forEach","name","hasOwnProperty","addError","n","addErrors","validate","additionalProperties","schema","key","toJSON","fromJSON","addCheck","isObject","isArray","extend","prototype"],"sources":["C:/game/mern/node_modules/jski/lib/object.js"],"sourcesContent":["var Validator = require('./validator.js');\nvar Constraint = require('./constraints.js').Constraint;\nvar VarArgsConstraint = require('./constraints.js').VarArgsConstraint;\nvar common = require('./common.js');\nvar serialize = require('./serialize.js');\n\n//\n// Object Validator\n//\n\nvar ObjectValidator = module.exports = function(context, args) {\n\n  Validator.call(this, context, 'object');\n\n  var properties = args ? args[0] : null;\n\n  this.addOption('additionalProperties', true);\n\n  this.addConstraint(new Constraint(\n    'maxProperties',\n    function(value, m, options, path) {\n      return Object.keys(value).length <= m ? [] : [\n        this.makeError('Number of properties is larger than maximum: ' + m, 'maxProperties', path)\n      ];\n    }\n  ));\n\n  this.addConstraint(new Constraint(\n    'minProperties',\n    function(value, m, options, path) {\n      return Object.keys(value).length >= m ? [] : [\n        this.makeError('Number of properties is less than minimum: ' + m, 'minProperties', path)\n      ];\n    }\n  ));\n\n  this.addConstraint(new VarArgsConstraint(\n    'required',\n    function(value, reqs, options, path) {\n      var errors = [];\n      var self = this;\n\n      reqs.forEach(function(name) {\n        if (!value.hasOwnProperty(name)) {\n          self.addError(errors, 'Required property is missing: ' + name, 'required', path + '/' + name);\n        }\n      });\n      return errors;\n    }\n  ));\n\n  this.addConstraint(new Constraint(\n    'properties',\n\n    function(value, properties, options, path) {\n      var errors = [];\n\n      for (var n in value) {\n        if (properties[n]) {\n          this.addErrors(errors, properties[n].validate(value[n], options, path + '/' + n));\n        }\n        else if (!this.additionalProperties()) {\n          this.addError(errors, 'Object has no property with name: ' + n, 'additionalProperties', path + '/' + n);\n        }\n      }\n      return errors;\n    },\n\n    function(properties) {\n      var schema = {};\n      Object.keys(properties).forEach(function(key) {\n        schema[key] = properties[key].toJSON();\n      });\n      return schema;\n    },\n\n    function(schema) {\n      properties = {};\n      Object.keys(schema).forEach(function(key) {\n        properties[key] = serialize.fromJSON(schema[key]);\n      });\n      return properties;\n    }\n  ));\n\n  this.addCheck(function(value, options, path) {\n    return common.isObject(value) && !common.isArray(value) ? [] : [\n      this.makeError('Value is not an object', 'object', path)\n    ];\n  });\n\n  // shortcut to set constraint\n  if (properties) this.properties(properties);\n};\n\ncommon.extend(ObjectValidator.prototype, Validator.prototype);\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}