{"ast":null,"code":"var serialize = require('./serialize.js');\nvar common = require('./common.js');\n\n//\n// Validator\n//\n\nvar Validator = module.exports = function (context, type) {\n  this.type = type;\n  this.context = context;\n  this._options = {};\n  this._constraints = [];\n  this._checks = [];\n  this._customAttributes = [];\n\n  // meta keywords\n  this.addOption('title', '');\n  this.addOption('description', '');\n  this.addOption('default');\n};\nValidator.prototype.__jski__ = true;\nValidator.prototype.toJSON = function (schema) {\n  schema = schema || {\n    type: this.type\n  };\n  var self = this;\n  Object.keys(this._options).forEach(function (key) {\n    if (self._options[key].enabled) {\n      schema[key] = self._options[key].value;\n    }\n  });\n  this._constraints.forEach(function (constraint) {\n    if (constraint.enabled) {\n      schema[constraint.name] = constraint.toJSON();\n    }\n  });\n  Object.keys(this._customAttributes).forEach(function (key) {\n    schema[key] = self._customAttributes[key];\n  });\n  return schema;\n};\nValidator.prototype.clone = function (context) {\n  context = context || this.context;\n  return serialize.fromJSON(this.toJSON(), context);\n};\nValidator.prototype.fromJSON = function (schema) {\n  var self = this;\n  Object.keys(schema).forEach(function (key) {\n    if (common.isKeyword(key)) return;\n    if (self._options.hasOwnProperty(key)) {\n      self._options[key] = {\n        enabled: true,\n        value: schema[key]\n      };\n    } else {\n      var isConstraint = false;\n      self._constraints.forEach(function (constraint) {\n        if (constraint.name === key) {\n          constraint.fromJSON(schema[key]);\n          isConstraint = true;\n        }\n      });\n      if (!isConstraint) {\n        self._customAttributes[key] = schema[key];\n      }\n    }\n  });\n  return this;\n};\nValidator.prototype.addOption = function (name, defaultValue) {\n  this._options[name] = {\n    enabled: false,\n    value: defaultValue\n  };\n  this[name] = function (value) {\n    // get value when not passed\n    if (common.isUndefined(value)) {\n      return this._options[name].value;\n    }\n\n    // set value\n    var o = this._options[name];\n    o.enabled = true;\n    o.value = value;\n    return this;\n  };\n};\nValidator.prototype.addConstraint = function (constraint) {\n  constraint.decorate(this);\n  this._constraints.push(constraint);\n};\nValidator.prototype.addCheck = function (check) {\n  this._checks.push(check);\n};\nValidator.prototype.definitions = function (defs) {\n  if (common.isUndefined(defs)) {\n    return this._definitions;\n  }\n  this._definitions = defs;\n  return this;\n};\nValidator.prototype.custom = function (name, value) {\n  if (typeof value === 'undefined') {\n    return this._customAttributes[name];\n  }\n  this._customAttributes[name] = value;\n  return this;\n};\nValidator.prototype.validate = function (value, options, path) {\n  // validate jski validators\n  if (common.isObject(value) && value.__jski__) {\n    value = value.toJSON();\n  }\n  path = path || '';\n  options = options || {};\n  var errors = [];\n  var self = this;\n\n  // pass on local definitions\n  var defs = this.definitions();\n  if (defs) {\n    options.definitions = options.definitions || {};\n    common.extend(options.definitions, defs);\n  }\n  this._constraints.forEach(function (constraint) {\n    if (constraint.enabled) {\n      self.addErrors(errors, constraint.validate(value, options, path));\n    }\n  });\n  this._checks.forEach(function (check) {\n    self.addErrors(errors, check.call(self, value, options, path));\n  });\n  return errors;\n};\nValidator.prototype.makeError = function (message, code, path) {\n  return {\n    message: message,\n    code: code,\n    path: path\n  };\n};\nValidator.prototype.addError = function (errors, message, code, path) {\n  errors.push(this.makeError.apply(this, common.cloneArgs(arguments, 1)));\n  return errors;\n};\nValidator.prototype.addErrors = function (errors, newErrors) {\n  newErrors.forEach(function (err) {\n    errors.push(err);\n  });\n  return errors;\n};","map":{"version":3,"names":["serialize","require","common","Validator","module","exports","context","type","_options","_constraints","_checks","_customAttributes","addOption","prototype","__jski__","toJSON","schema","self","Object","keys","forEach","key","enabled","value","constraint","name","clone","fromJSON","isKeyword","hasOwnProperty","isConstraint","defaultValue","isUndefined","o","addConstraint","decorate","push","addCheck","check","definitions","defs","_definitions","custom","validate","options","path","isObject","errors","extend","addErrors","call","makeError","message","code","addError","apply","cloneArgs","arguments","newErrors","err"],"sources":["C:/game/mern/node_modules/jski/lib/validator.js"],"sourcesContent":["var serialize = require('./serialize.js');\nvar common = require('./common.js');\n\n\n//\n// Validator\n//\n\nvar Validator = module.exports = function(context, type) {\n\n  this.type = type;\n  this.context = context;\n  this._options = {};\n  this._constraints = [];\n  this._checks = [];\n  this._customAttributes = [];\n\n  // meta keywords\n  this.addOption('title', '');\n  this.addOption('description', '');\n  this.addOption('default');\n};\n\n\nValidator.prototype.__jski__ = true;\n\n\nValidator.prototype.toJSON = function(schema) {\n\n  schema = schema || { type: this.type };\n  var self = this;\n\n  Object.keys(this._options).forEach(function(key) {\n    if (self._options[key].enabled) {\n      schema[key] = self._options[key].value;\n    }\n  });\n\n  this._constraints.forEach(function(constraint) {\n    if (constraint.enabled) {\n      schema[constraint.name] = constraint.toJSON();\n    }\n  });\n\n  Object.keys(this._customAttributes).forEach(function(key) {\n    schema[key] = self._customAttributes[key];\n  });\n\n  return schema;\n};\n\n\nValidator.prototype.clone = function(context) {\n\n  context = context || this.context;\n  return serialize.fromJSON(this.toJSON(), context);\n};\n\n\nValidator.prototype.fromJSON = function(schema) {\n\n  var self = this;\n\n  Object.keys(schema).forEach(function(key) {\n\n    if (common.isKeyword(key)) return;\n\n    if (self._options.hasOwnProperty(key)) {\n      self._options[key] = {\n        enabled: true,\n        value: schema[key]\n      };\n    }\n    else {\n      var isConstraint = false;\n\n      self._constraints.forEach(function(constraint) {\n        if (constraint.name === key) {\n          constraint.fromJSON(schema[key]);\n          isConstraint = true;\n        }\n      });\n\n      if (!isConstraint) {\n        self._customAttributes[key] = schema[key];\n      }\n    }\n  });\n\n  return this;\n};\n\n\nValidator.prototype.addOption = function(name, defaultValue) {\n\n  this._options[name] = {\n    enabled: false,\n    value: defaultValue\n  };\n\n  this[name] = function(value) {\n\n    // get value when not passed\n    if (common.isUndefined(value)) {\n      return this._options[name].value;\n    }\n\n    // set value\n    var o = this._options[name];\n    o.enabled = true;\n    o.value = value;\n\n    return this;\n  };\n};\n\n\nValidator.prototype.addConstraint = function(constraint) {\n\n  constraint.decorate(this);\n  this._constraints.push(constraint);\n};\n\n\nValidator.prototype.addCheck = function(check) {\n\n  this._checks.push(check);\n};\n\n\nValidator.prototype.definitions = function(defs) {\n\n  if (common.isUndefined(defs)) {\n    return this._definitions;\n  }\n  this._definitions = defs;\n  return this;\n}\n\n\nValidator.prototype.custom = function(name, value) {\n\n  if (typeof value === 'undefined') {\n    return this._customAttributes[name];\n  }\n  this._customAttributes[name] = value;\n  return this;\n};\n\n\nValidator.prototype.validate = function(value, options, path) {\n\n  // validate jski validators\n  if (common.isObject(value) && value.__jski__) {\n    value = value.toJSON();\n  }\n\n  path = path || '';\n  options = options || {};\n\n  var errors = [];\n  var self = this;\n\n  // pass on local definitions\n  var defs = this.definitions();\n  if (defs) {\n    options.definitions = options.definitions || {};\n    common.extend(options.definitions, defs);\n  }\n\n  this._constraints.forEach(function(constraint) {\n    if (constraint.enabled) {\n      self.addErrors(errors, constraint.validate(value, options, path));\n    }\n  });\n\n  this._checks.forEach(function(check) {\n    self.addErrors(errors, check.call(self, value, options, path));\n  });\n\n  return errors;\n};\n\n\nValidator.prototype.makeError = function(message, code, path) {\n\n  return { message: message, code: code, path: path };\n};\n\n\nValidator.prototype.addError = function(errors, message, code, path) {\n\n  errors.push(this.makeError.apply(this, common.cloneArgs(arguments, 1)));\n  return errors;\n};\n\n\nValidator.prototype.addErrors = function(errors, newErrors) {\n\n  newErrors.forEach(function(err) {\n    errors.push(err);\n  });\n  return errors;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}